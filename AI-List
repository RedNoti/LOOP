# ğŸ¤– Gemini AI API ì½”ë“œ ì •ë¦¬ (LOOP í”„ë¡œì íŠ¸ìš©)

## ğŸ“‹ ê°œìš”
ì´ íŒŒì¼ì€ LOOP í”„ë¡œì íŠ¸ì— Gemini AI APIë¥¼ ì—°ë™í•˜ê¸° ìœ„í•œ ì½”ë“œë¥¼ ì •ë¦¬í•œ ê²ƒì…ë‹ˆë‹¤.
**ë°±ì—”ë“œ í”„ë¡ì‹œ ë°©ì‹**ìœ¼ë¡œ ì•ˆì „í•˜ê³  í”„ë¡œë•ì…˜ ì¤€ë¹„ëœ êµ¬ì¡°ë¡œ êµ¬í˜„í•©ë‹ˆë‹¤.

---

## ğŸ”§ 1. ë°±ì—”ë“œ í”„ë¡ì‹œ ë°©ì‹ (ê¶Œì¥ ì•„í‚¤í…ì²˜)

### ğŸ“ íŒŒì¼ ìœ„ì¹˜: `server/index.ts` (ìƒˆë¡œ ìƒì„±)

#### 1.1 Express ì„œë²„ í”„ë¡ì‹œ (í”„ë¡œë•ì…˜ ë ˆë²¨)
```typescript
// server/index.ts
import "dotenv/config";
import express from "express";
import cors from "cors";
import helmet from "helmet";
import rateLimit from "express-rate-limit";

// Node 18+ ëŠ” fetch ë‚´ì¥ (node-fetch ë¶ˆí•„ìš”)
// import fetch from "node-fetch"; // âŒ ì œê±° ê¶Œì¥

const app = express();
const isProd = process.env.NODE_ENV === "production";
const PORT = Number(process.env.PORT ?? 5000);
const MODEL = process.env.GEMINI_MODEL ?? "gemini-2.0-flash";
const GEMINI_URL = `https://generativelanguage.googleapis.com/v1/models/${MODEL}:generateContent?key=${process.env.GEMINI_API_KEY}`;

app.use(helmet());
app.use(cors({
  origin: isProd
    ? (process.env.FRONTEND_URL || "https://your-frontend-domain.com")
    : (process.env.FRONTEND_URL || "http://localhost:3000"),
  credentials: true,
  methods: ["POST"],
  allowedHeaders: ["Content-Type", "Authorization"]
}));
app.use(express.json({ limit: "1mb" }));
app.use(rateLimit({ windowMs: 60_000, max: 60 })); // ë¶„ë‹¹ 60íšŒ

app.post("/api/ai-search", async (req, res) => {
  try {
    // í™˜ê²½ ì ê²€
    if (!process.env.GEMINI_API_KEY) {
      console.error("âŒ GEMINI_API_KEY missing");
      return res.status(500).json({ success: false, error: "server_config_error" });
    }

    const { query } = req.body ?? {};
    // ì…ë ¥ ê²€ì¦
    if (!query || typeof query !== "string" || !query.trim()) {
      return res.status(400).json({
        success: false,
        error: "empty_query",
        message: "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."
      });
    }
    if (query.length > 500) {
      return res.status(400).json({
        success: false,
        error: "query_too_long",
        message: "ê²€ìƒ‰ì–´ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤."
      });
    }

    const sanitized = query.replace(
      /<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,
      ""
    );

    // í”„ë¡¬í”„íŠ¸
    const prompt = buildPrompt(sanitized);
    const payload = { contents: [{ parts: [{ text: prompt }]}] };

    // íƒ€ì„ì•„ì›ƒ ì„¤ì •
    const ac = new AbortController();
    const timer = setTimeout(() => ac.abort(), 15_000);

    // Gemini í˜¸ì¶œ
    const response = await fetch(GEMINI_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(payload),
      signal: ac.signal
    }).finally(() => clearTimeout(timer));

    if (!response.ok) {
      const errorText = await response.text();
      console.error("âŒ Gemini API ì˜¤ë¥˜:", response.status, errorText);
      return res.status(502).json({
        success: false,
        error: "gemini_error",
        detail: errorText
      });
    }

    const data: any = await response.json();
    const text: string = data?.candidates?.[0]?.content?.parts?.[0]?.text ?? "";

    // êµ¬ì¡°í™”(íŒŒì‹±) ê²°ê³¼ í•¨ê»˜ ì œê³µ â†’ ì´í›„ ìë™ì¬ìƒ íŒŒì´í”„ë¼ì¸ ì—°ê²° ì‰¬ì›€
    const tracks = parseTracks(text);

    console.log("âœ… Gemini API ì‘ë‹µ ìƒì„± ì™„ë£Œ");
    return res.json({ success: true, recommendations: text, tracks });
  } catch (error: any) {
    const aborted = error?.name === "AbortError";
    console.error("âŒ ì„œë²„ ì˜¤ë¥˜:", aborted ? "timeout" : error?.message);
    return res.status(aborted ? 504 : 500).json({
      success: false,
      error: aborted ? "timeout" : "server_error",
      detail: error?.message
    });
  }
});

// í”„ë¡¬í”„íŠ¸ ë¹Œë”
function buildPrompt(query: string): string {
  return `ë‹¹ì‹ ì€ LOOP ìŒì•… ì•±ì˜ AI ì¶”ì²œ ì „ë¬¸ê°€ì…ë‹ˆë‹¤. ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ YouTubeì—ì„œ ê²€ìƒ‰ ê°€ëŠ¥í•œ êµ¬ì²´ì ì¸ ë…¸ë˜ ì œëª©ê³¼ ì•„í‹°ìŠ¤íŠ¸ë¥¼ ì¶”ì²œí•´ì£¼ì„¸ìš”.

ì‚¬ìš©ì ìš”ì²­: ${query}

í˜•ì‹(ì¤‘ìš”):
- ê° ì¤„ì€ ë°˜ë“œì‹œ "ë…¸ë˜ ì œëª© - ì•„í‹°ìŠ¤íŠ¸ëª…" í•œ ìŒë§Œ í¬í•¨
- ë²ˆí˜¸/ë¶ˆë¦¿ í—ˆìš© (ì˜ˆ: "1) " ë˜ëŠ” "- "), ë‹¨ í•œ ì¤„ì— ë…¸ë˜ 1ê°œë§Œ
- ë…¸íŠ¸(ì„¤ëª…)ëŠ” ê³¡ëª… ë’¤ ê´„í˜¸ë¡œ 10ì ì´ë‚´ (ì„ íƒ)

ì˜ˆì‹œ:
- ë°¤í¸ì§€ - ì•„ì´ìœ  (í¬í¬ ë°œë¼ë“œ)
- Blueming - ì•„ì´ìœ  (íŒ ë¡)

ì£¼ì˜: ì‹¤ì œë¡œ ì¡´ì¬í•˜ê³  YouTubeì—ì„œ ê²€ìƒ‰ ê°€ëŠ¥í•œ ê³¡ë§Œ.`;
}

// ê°„ë‹¨ íŒŒì„œ: "ì œëª© - ì•„í‹°ìŠ¤íŠ¸ (ì„ íƒ ë…¸íŠ¸)"
function parseTracks(text: string) {
  return text
    .split("\n")
    .map(l => l.replace(/^\s*[\-\d\.\)]\s*/, "").trim())
    .filter(Boolean)
    .map(l => {
      const m = l.match(/^(.*?)-(.*?)(?:\s*\(([^()]*)\))?\s*$/);
      if (!m) return null;
      const title = m[1]?.trim();
      const artist = m[2]?.trim();
      const note = m[3]?.trim();
      if (!title || !artist) return null;
      return { title, artist, note };
    })
    .filter(Boolean);
}

app.listen(PORT, () => {
  const envMsg = isProd ? "production" : "development";
  console.log(`ğŸš€ LOOP Gemini API ì„œë²„ê°€ í¬íŠ¸ ${PORT}ì—ì„œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤. (${envMsg})`);
});
```

### ğŸ“ íŒŒì¼ ìœ„ì¹˜: `src/services/geminiApi.ts` (ìƒˆë¡œ ìƒì„±)

#### 1.2 í´ë¼ì´ì–¸íŠ¸ í”„ë¡ì‹œ í˜¸ì¶œ í•¨ìˆ˜ (êµ¬ì¡°í™”ëœ ì‘ë‹µ ì§€ì›)
```typescript
// src/services/geminiApi.ts
export type Track = { title: string; artist: string; note?: string };

export interface GeminiResult {
  success: boolean;
  recommendations: string; // ì›ë¬¸ í…ìŠ¤íŠ¸
  tracks?: Track[];        // íŒŒì‹±ëœ êµ¬ì¡°í™” ê²°ê³¼
  error?: string;
  detail?: string;
}

export async function callGeminiAPI(query: string): Promise<GeminiResult> {
  const res = await fetch("/api/ai-search", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ query })
  });
  const data = await res.json();
  if (!res.ok || !data?.success) {
    throw new Error(data?.detail || data?.error || "Gemini API í˜¸ì¶œ ì‹¤íŒ¨");
  }
  return data as GeminiResult;
}
```

---

## ğŸ¨ 2. í´ë¼ì´ì–¸íŠ¸ ì¸¡ ì½”ë“œ (Frontend) - LOOP í”„ë¡œì íŠ¸ì— ì¶”ê°€

### ğŸ“ íŒŒì¼ ìœ„ì¹˜: `src/hooks/useAISearch.tsx` (ìƒˆë¡œ ìƒì„±)
```typescript
import { useState } from "react";
import { callGeminiAPI, GeminiResult, Track } from "../services/geminiApi";

// LOOP í”„ë¡œì íŠ¸ìš© AI ê²€ìƒ‰ ìƒíƒœë¥¼ ê´€ë¦¬í•˜ëŠ” ì»¤ìŠ¤í…€ í›… (í”„ë¡ì‹œ íŒ¨í„´)
export function useAISearch() {
  const [recommendations, setRecommendations] = useState<string>('');
  const [tracks, setTracks] = useState<Track[]>([]);
  const [loading, setLoading] = useState(false);
  const [error, setError] = useState<string | null>(null);

  const searchWithAI = async (query: string) => {
    try {
      setLoading(true);
      setError(null);

      const result: GeminiResult = await callGeminiAPI(query);
      setRecommendations(result.recommendations ?? '');
      setTracks(result.tracks ?? []);
    } catch (err: any) {
      setError(err.message || "LOOP AI ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.");
    } finally {
      setLoading(false);
    }
  };

  return { recommendations, tracks, loading, error, searchWithAI };
}
```

### ğŸ“ íŒŒì¼ ìœ„ì¹˜: `src/components/AISearchBar.tsx` (ìƒˆë¡œ ìƒì„±)
```typescript
import { useState } from "react";

// LOOP í”„ë¡œì íŠ¸ìš© AI ê²€ìƒ‰ ë°” ì»´í¬ë„ŒíŠ¸ Props íƒ€ì…
interface AISearchBarProps {
    onAISearch: (query: string) => void;
    loading: boolean;
}

// LOOP í”„ë¡œì íŠ¸ìš© AI ê²€ìƒ‰ ì…ë ¥ í¼ ì»´í¬ë„ŒíŠ¸
export default function AISearchBar({ onAISearch, loading}: AISearchBarProps) {
    const [query, setQuery] = useState('');

    // í¼ ì œì¶œ í•¸ë“¤ëŸ¬
    const handleSubmit = (e: React.FormEvent) => {
        e.preventDefault();
        if (query.trim()) {
            onAISearch(query);
        }
    };

    return (
        <div style={{ 
            marginBottom: '20px', 
            padding: '15px', 
            background: 'linear-gradient(135deg, #667eea 0%, #764ba2 100%)', 
            borderRadius: '12px',
            boxShadow: '0 4px 15px rgba(0,0,0,0.1)'
        }}>
            <h3 style={{ 
                margin: '0 0 10px 0', 
                color: 'white',
                fontSize: '18px',
                fontWeight: 'bold'
            }}>ğŸ¤– LOOP AIë¡œ ë…¸ë˜ ì°¾ê¸°</h3>
            <form onSubmit={handleSubmit}>
                <input
                type="text"
                value={query}
                onChange={(e) => setQuery(e.target.value)}
                placeholder="ì˜ˆ: ìµœê·¼ ìœ í–‰í•˜ëŠ” ì•„ì´ìœ  ë…¸ë˜ë¥¼ 5ê³¡ ì•Œë ¤ì¤˜"
                style={{
                    width: '100%',
                    padding: '12px',
                    marginBottom: '10px',
                    border: 'none',
                    borderRadius: '8px',
                    fontSize: '16px',
                    outline: 'none',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.1)'
                }}
                />
                <button
                type="submit"
                disabled={loading}
                style={{
                    padding: '12px 20px',
                    backgroundColor: loading ? '#ccc' : '#ff6b6b',
                    color: 'white',
                    border: 'none',
                    borderRadius: '8px',
                    cursor: loading ? "not-allowed" : 'pointer',
                    fontSize: '16px',
                    fontWeight: 'bold',
                    boxShadow: '0 2px 10px rgba(0,0,0,0.2)',
                    transition: 'all 0.3s ease'
                }}
                >
                    {loading ? "ğŸ¤– AI ê²€ìƒ‰ì¤‘..." : "ğŸš€ AI ê²€ìƒ‰"}
                </button>
            </form>
        </div>
    );
}
```

### ğŸ“ íŒŒì¼ ìœ„ì¹˜: `src/screens/KategorieScreen.tsx` (ê¸°ì¡´ íŒŒì¼ì— ì¶”ê°€)
```typescript
// ê¸°ì¡´ KategorieScreen.tsxì— ì¶”ê°€í•  ì½”ë“œ
import AISearchBar from "../components/AISearchBar";
import { useAISearch } from "../hooks/useAISearch";

// InnerKategorieScreen ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ì¶”ê°€
function InnerKategorieScreen() {
  // ê¸°ì¡´ ì½”ë“œë“¤...
  
  // AI ê²€ìƒ‰ í›… ì¶”ê°€
  const { recommendations, loading: aiLoading, error: aiError, searchWithAI } = useAISearch();

  return (
    <Wrapper theme={theme}>
      {/* ê¸°ì¡´ ê²€ìƒ‰ ë°” ìœ„ì— AI ê²€ìƒ‰ ë°” ì¶”ê°€ */}
      <AISearchBar onAISearch={searchWithAI} loading={aiLoading} />
      
      {/* ê¸°ì¡´ ê²€ìƒ‰ ë°” */}
      <SearchBar>
        {/* ê¸°ì¡´ ê²€ìƒ‰ ë°” ì½”ë“œ... */}
      </SearchBar>

      {/* AI ì¶”ì²œ ê²°ê³¼ í‘œì‹œ */}
      {recommendations && (
        <div style={{
          background: 'linear-gradient(135deg, #e8f5e8 0%, #f0f8f0 100%)',
          padding: '20px',
          borderRadius: '12px',
          marginBottom: '20px',
          border: '2px solid #4caf50',
          boxShadow: '0 4px 15px rgba(76, 175, 80, 0.2)'
        }}>
          <h3 style={{ 
            margin: '0 0 15px 0', 
            color: '#2e7d32',
            fontSize: '18px',
            fontWeight: 'bold'
          }}>ğŸ¤– LOOP AI ì¶”ì²œ ê²°ê³¼</h3>
          <div style={{ 
            margin: 0,
            lineHeight: '1.8',
            whiteSpace: 'pre-line',
            color: '#333',
            fontSize: '14px'
          }}>{recommendations}</div>
          
          {/* í–¥í›„ ìë™ì¬ìƒ íŒŒì´í”„ë¼ì¸ ì—°ê²° ì¤€ë¹„ */}
          {tracks && tracks.length > 0 && (
            <div style={{ marginTop: '15px', padding: '10px', background: '#f8f9fa', borderRadius: '8px' }}>
              <h4 style={{ margin: '0 0 10px 0', color: '#495057', fontSize: '14px' }}>
                ğŸµ íŒŒì‹±ëœ íŠ¸ë™ ({tracks.length}ê³¡)
              </h4>
              {tracks.map((track, index) => (
                <div key={index} style={{ 
                  padding: '5px 0', 
                  borderBottom: index < tracks.length - 1 ? '1px solid #dee2e6' : 'none',
                  fontSize: '13px'
                }}>
                  <strong>{track.title}</strong> - {track.artist}
                  {track.note && <span style={{ color: '#6c757d' }}> ({track.note})</span>}
                </div>
              ))}
              {/* í–¥í›„ ìë™ì¬ìƒ ë²„íŠ¼ ì˜ˆì‹œ */}
              {/* <button onClick={() => playTracksViaYouTube(tracks, 0)}>ğŸµ ì¶”ì²œ ê³¡ ë°”ë¡œ ì¬ìƒ</button> */}
            </div>
          )}
        </div>
      )}

      {/* AI ì—ëŸ¬ í‘œì‹œ */}
      {aiError && (
        <div style={{
          background: '#ffebee',
          padding: '15px',
          borderRadius: '8px',
          marginBottom: '20px',
          border: '1px solid #f44336',
          color: '#c62828'
        }}>
          <strong>âŒ AI ê²€ìƒ‰ ì˜¤ë¥˜:</strong> {aiError}
        </div>
      )}

      {/* ê¸°ì¡´ ë¹„ë””ì˜¤ ê·¸ë¦¬ë“œ */}
      <VideoGrid>
        {/* ê¸°ì¡´ ë¹„ë””ì˜¤ ì¹´ë“œë“¤... */}
      </VideoGrid>
    </Wrapper>
  );
}
```

---

## ğŸ“¦ 3. í™˜ê²½ ë³€ìˆ˜ ì„¤ì • - LOOP í”„ë¡œì íŠ¸ìš© (ë°±ì—”ë“œ í”„ë¡ì‹œ)

### ğŸ“ ì„œë²„ í™˜ê²½ ë³€ìˆ˜: `.env` (ë£¨íŠ¸ í´ë”ì— ì¶”ê°€)
```bash
# ê¸°ì¡´ YouTube API í‚¤ (í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ìš© ë°±ì—…)
REACT_APP_YOUTUBE_API_KEY=AIzaSyBNWPwKZ26XlK0O5JCqooZFoAk2FScx2fE

# Gemini AI API í‚¤ (ì„œë²„ì—ì„œ ì‚¬ìš©)
GEMINI_API_KEY=your_gemini_api_key_here

# ëª¨ë¸ ë³€ê²½ì´ ì‰¬ìš°ë„ë¡
GEMINI_MODEL=gemini-2.0-flash

# ì„œë²„ í¬íŠ¸
PORT=5000

# í™˜ê²½ ì„¤ì •
NODE_ENV=development

# (ìš´ì˜ì‹œ) í—ˆìš© í”„ë¡ íŠ¸ ë„ë©”ì¸
FRONTEND_URL=http://localhost:3000
```

### ğŸ“ ì„œë²„ ì˜ì¡´ì„±: `server/package.json` (ìƒˆë¡œ ìƒì„±)
```json
{
  "name": "loop-gemini-server",
  "version": "1.0.0",
  "description": "LOOP í”„ë¡œì íŠ¸ Gemini AI í”„ë¡ì‹œ ì„œë²„",
  "main": "index.ts",
  "scripts": {
    "start": "node dist/index.js",
    "dev": "ts-node index.ts",
    "build": "tsc"
  },
  "dependencies": {
    "express": "^4.18.2",
    "cors": "^2.8.5",
    "helmet": "^7.1.0",
    "express-rate-limit": "^7.1.5",
    "dotenv": "^16.3.1"
  },
  "devDependencies": {
    "@types/express": "^4.17.21",
    "@types/cors": "^2.8.17",
    "@types/node": "^20.10.0",
    "typescript": "^5.3.0",
    "ts-node": "^10.9.0"
  }
}
```

---

## ğŸ” 4. LOOP í”„ë¡œì íŠ¸ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­ (ë°±ì—”ë“œ í”„ë¡ì‹œ)

### 4.1 API í‚¤ ë³´ì•ˆ (ì¤‘ìš”)
```typescript
// server/index.tsì—ì„œ ì…ë ¥ ê²€ì¦ ê°•í™”
app.post("/api/ai-search", async (req, res) => {
  const { query } = req.body ?? {};
  
  // ì…ë ¥ ê²€ì¦
  if (!query || typeof query !== 'string' || query.trim().length === 0) {
    return res.status(400).json({ 
      success: false, 
      error: "empty_query",
      message: "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”." 
    });
  }
  
  if (query.length > 500) {
    return res.status(400).json({ 
      success: false, 
      error: "query_too_long",
      message: "ê²€ìƒ‰ì–´ê°€ ë„ˆë¬´ ê¹ë‹ˆë‹¤." 
    });
  }
  
  // XSS ë°©ì§€
  const sanitizedQuery = query.replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '');
  
  // API í‚¤ í™•ì¸ (ì„œë²„ì—ì„œë§Œ)
  const apiKey = process.env.GEMINI_API_KEY;
  if (!apiKey) {
    console.error('âŒ GEMINI_API_KEYê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.');
    return res.status(500).json({ 
      success: false, 
      error: "server_config_error" 
    });
  }
  
  // ë‚˜ë¨¸ì§€ ë¡œì§...
});
```

### 4.2 ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
```typescript
// src/hooks/useAISearch.tsxì—ì„œ ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
const searchWithAI = async (query: string) => {
  try {
    setLoading(true);
    setError(null);
    
    // ì…ë ¥ ê²€ì¦
    if (!query.trim()) {
      setError('ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      return;
    }
    
    const result = await callGeminiAPI(query);
    setRecommendations(result);
    
  } catch (err: any) {
    console.error('âŒ LOOP AI í”„ë¡ì‹œ ê²€ìƒ‰ ì˜¤ë¥˜:', err);
    
    // êµ¬ì²´ì ì¸ ì—ëŸ¬ ë©”ì‹œì§€
    if (err.message.includes('ì„œë²„')) {
      setError('ì„œë²„ ì—°ê²°ì— ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
    } else if (err.message.includes('ë„¤íŠ¸ì›Œí¬')) {
      setError('ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
    } else {
      setError(err.message || 'AI ê²€ìƒ‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí•˜ì˜€ìŠµë‹ˆë‹¤.');
    }
  } finally {
    setLoading(false);
  }
};
```

---

## ğŸš€ 5. LOOP í”„ë¡œì íŠ¸ ì„¤ì¹˜ ë° ì‹¤í–‰ ê°€ì´ë“œ (ë°±ì—”ë“œ í”„ë¡ì‹œ)

### 5.1 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# 1. ë£¨íŠ¸ í´ë”ì˜ .env íŒŒì¼ì— ì¶”ê°€
GEMINI_API_KEY=your_gemini_api_key_here

# 2. Gemini API í‚¤ ë°œê¸‰ (Google AI Studioì—ì„œ)
# https://aistudio.google.com/app/apikey
```

### 5.2 ì„œë²„ ì„¤ì •
```bash
# 1. server í´ë” ìƒì„± ë° ì˜ì¡´ì„± ì„¤ì¹˜
mkdir server
cd server
npm init -y
npm install express cors helmet express-rate-limit dotenv
npm install -D @types/express @types/cors @types/node typescript ts-node

# 2. server/index.ts íŒŒì¼ ìƒì„± (ìœ„ ì½”ë“œ ì°¸ì¡°)
# 3. server/package.json ì„¤ì • (ìœ„ ì½”ë“œ ì°¸ì¡°)
```

### 5.3 í´ë¼ì´ì–¸íŠ¸ íŒŒì¼ ìƒì„±
```bash
# í•„ìš”í•œ íŒŒì¼ë“¤ ìƒì„±
# - src/services/geminiApi.ts
# - src/hooks/useAISearch.tsx  
# - src/components/AISearchBar.tsx

# 4. KategorieScreen.tsxì— AI ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€
```

### 5.4 ì‹¤í–‰ ë° í…ŒìŠ¤íŠ¸
```bash
# 1. ì„œë²„ ì‹¤í–‰ (í„°ë¯¸ë„ 1)
cd server
npm run dev

# 2. í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰ (í„°ë¯¸ë„ 2)
npm start

# 3. ë¸Œë¼ìš°ì €ì—ì„œ http://localhost:3000 ì ‘ì†
# 4. KategorieScreenì—ì„œ AI ê²€ìƒ‰ ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸
```

---

## âœ… 6. LOOP í”„ë¡œì íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ë°±ì—”ë“œ í”„ë¡ì‹œ)

### í•„ìˆ˜ ì‘ì—…:
- [ ] ë£¨íŠ¸ `.env`ì— `GEMINI_API_KEY` ì¶”ê°€
- [ ] `server/` í´ë” ìƒì„± ë° Express ì„œë²„ ì„¤ì •
- [ ] `server/index.ts` ìƒì„± (í”„ë¡ì‹œ ì„œë²„)
- [ ] `server/package.json` ìƒì„± (ì˜ì¡´ì„± ì„¤ì •)
- [ ] `src/services/geminiApi.ts` ìƒì„± (í”„ë¡ì‹œ í˜¸ì¶œ)
- [ ] `src/hooks/useAISearch.tsx` ìƒì„± (í”„ë¡ì‹œ íŒ¨í„´)
- [ ] `src/components/AISearchBar.tsx` ìƒì„±
- [ ] `KategorieScreen.tsx`ì— AI ê²€ìƒ‰ ê¸°ëŠ¥ ì¶”ê°€

### ì„ íƒ ì‘ì—…:
- [ ] ì…ë ¥ ê²€ì¦ ì¶”ê°€
- [ ] ì—ëŸ¬ í•¸ë“¤ë§ ê°•í™”
- [ ] ë¡œë”© ìƒíƒœ ê°œì„ 
- [ ] Rate Limiting ì¶”ê°€
- [ ] ì‘ë‹µ ìºì‹± ì¶”ê°€

### ì¥ì :
- âœ… **í”„ë¡œë•ì…˜ ì¤€ë¹„**: êµ¬ê¸€ ê¶Œì¥ ë°©ì‹
- âœ… **ë³´ì•ˆì„±**: helmet + rate limiting + API í‚¤ ì„œë²„ ê´€ë¦¬
- âœ… **CORS í•´ê²°**: í™˜ê²½ë³„ ìë™ ë¶„ë¦¬
- âœ… **í™•ì¥ì„±**: êµ¬ì¡°í™”ëœ ì‘ë‹µìœ¼ë¡œ ìë™ì¬ìƒ íŒŒì´í”„ë¼ì¸ ì¤€ë¹„
- âœ… **ì•ˆì •ì„±**: íƒ€ì„ì•„ì›ƒ + ì™„ë²½í•œ ì—ëŸ¬ ì²˜ë¦¬
- âœ… **í˜„ëŒ€ì **: Node 18+ ë‚´ì¥ fetch ì‚¬ìš©
- âœ… **ëª¨ë‹ˆí„°ë§**: ì„œë²„ì—ì„œ ì‚¬ìš©ëŸ‰ ì¶”ì 

### ì£¼ì˜ì‚¬í•­:
- âš ï¸ **ì„œë²„ í•„ìš”**: Express ì„œë²„ êµ¬ì¶• í•„ìš”
- âš ï¸ **API í‚¤ ê´€ë¦¬**: ì„œë²„ í™˜ê²½ ë³€ìˆ˜ ì„¤ì • í•„ìš”
- âš ï¸ **í¬íŠ¸ ì„¤ì •**: í´ë¼ì´ì–¸íŠ¸-ì„œë²„ í¬íŠ¸ ë¶„ë¦¬
- âš ï¸ **ë°°í¬ ë³µì¡ì„±**: ì„œë²„ ë°°í¬ í™˜ê²½ ê³ ë ¤

---

## ğŸ”— 7. ì°¸ê³  ë§í¬

- [Google Generative AI Documentation](https://ai.google.dev/docs)
- [Gemini API Reference](https://ai.google.dev/api/rest)
- [Express.js Documentation](https://expressjs.com/)
- [React Hooks Documentation](https://react.dev/reference/react)

---

## ğŸ¯ 8. ì˜¤ëŠ˜ êµ¬í˜„ ì™„ë£Œëœ ê¸°ëŠ¥ë“¤ (2025ë…„ 1ì›”)

### 8.1 ì‹¤ì œ êµ¬í˜„ëœ íŒŒì¼ë“¤

#### âœ… ì™„ë£Œëœ ë°±ì—”ë“œ íŒŒì¼ë“¤
- **`server/index.ts`** - Express í”„ë¡ì‹œ ì„œë²„ (ì™„ë£Œ)
- **`server/package.json`** - ì„œë²„ ì˜ì¡´ì„± ì„¤ì • (ì™„ë£Œ)
- **`server/tsconfig.json`** - TypeScript ì„¤ì • (ì™„ë£Œ)
- **`server/.env`** - í™˜ê²½ ë³€ìˆ˜ ì„¤ì • (ì™„ë£Œ)

#### âœ… ì™„ë£Œëœ í”„ë¡ íŠ¸ì—”ë“œ íŒŒì¼ë“¤
- **`src/services/geminiApi.ts`** - Gemini API í´ë¼ì´ì–¸íŠ¸ (ì™„ë£Œ)
- **`src/hook/useAISearch.tsx`** - AI ê²€ìƒ‰ í›… (ì™„ë£Œ)
- **`src/components/AISearchBar.tsx`** - AI ê²€ìƒ‰ ë°” ì»´í¬ë„ŒíŠ¸ (ì™„ë£Œ)
- **`src/screens/KategorieScreen.tsx`** - AI ê²€ìƒ‰ ê¸°ëŠ¥ í†µí•© (ì™„ë£Œ)

#### âœ… ìˆ˜ì •ëœ ì„¤ì • íŒŒì¼ë“¤
- **`package.json`** - í”„ë¡ì‹œ ì„¤ì • ì¶”ê°€ (ì™„ë£Œ)

### 8.2 êµ¬í˜„ëœ í•µì‹¬ ê¸°ëŠ¥ë“¤

#### ğŸ¤– AI ê²€ìƒ‰ ê¸°ëŠ¥
```typescript
// Gemini AIë¥¼ í†µí•œ ìŒì•… ì¶”ì²œ
const { recommendations, tracks, loading, error, searchWithAI, playTrack } = useAISearch();
```

#### ğŸµ YouTube API ì—°ë™
```typescript
// AI ì¶”ì²œ íŠ¸ë™ì— YouTube ë°ì´í„° ì¶”ê°€
const searchResults = await ytSearch({ q: searchQuery, type: "video"}); // 100 units
const videoDetails = await ytVideosDetails([searchResults[0].id.videoId]); // 1 unit
```

#### ğŸ¶ ì¬ìƒëª©ë¡ ìƒì„±
```typescript
// AI ì¶”ì²œ íŠ¸ë™ì„ ì¬ìƒëª©ë¡ìœ¼ë¡œ ìƒì„±
const playlistData = {
  id: `ai:${originalQuery}:${Date.now()}`,
  title: `AI ì¶”ì²œ: ${originalQuery}`,
  thumbnail: track.youtube.thumbnail,
  tracks: [{
    videoId: track.youtube.id,
    title: track.youtube.title,
    thumbnail: track.youtube.thumbnail,
  }],
  startIndex: 0
};
```

### 8.3 API ì‚¬ìš©ëŸ‰ ë¶„ì„ ì™„ë£Œ

#### ğŸ“Š YouTube Data API v3 ë¹„ìš©
- **search.list**: 100 units per request
- **videos.list**: 1 unit per request
- **AI ê²€ìƒ‰ 1íšŒ (5ê°œ íŠ¸ë™)**: 505 units
- **ì¼ì¼ í• ë‹¹ëŸ‰**: 10,000 units (ë¬´ë£Œ)

#### âš ï¸ ì‚¬ìš©ëŸ‰ ìµœì í™” í•„ìš”
- **ìºì‹± ì‹œìŠ¤í…œ** êµ¬í˜„ ê¶Œì¥
- **ì‚¬ìš©ì ì œí•œ** ì„¤ì • ê¶Œì¥
- **ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§** ì¶”ê°€ ê¶Œì¥

### 8.4 í•´ê²°ëœ ë¬¸ì œë“¤

#### ğŸ”§ ê¸°ìˆ ì  ë¬¸ì œ í•´ê²°
- **TypeScript ì˜¤ë¥˜** í•´ê²° (íƒ€ì… ê°€ë“œ, Non-null assertion)
- **ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ í‚¤ ë¶ˆì¼ì¹˜** ë¬¸ì œ í•´ê²°
- **ì¬ìƒ ë²„íŠ¼ ë¬´ë°˜ì‘** ë¬¸ì œ í•´ê²°
- **ì„œë²„ í¬íŠ¸ ì„¤ì •** ë¬¸ì œ í•´ê²°

#### ğŸš¨ ì˜¤ë¥˜ í•´ê²°
- **403 Forbidden** ì˜¤ë¥˜ (YouTube API Key ì„¤ì •)
- **WebSocket ì—°ê²° ì‹¤íŒ¨** ì˜¤ë¥˜ (í¬íŠ¸ ë¶ˆì¼ì¹˜)
- **Rate Limit ì„¤ì •** ì˜¤ë¥˜ (trust proxy ì„¤ì •)

---

## ğŸ”„ 10. ë‹¤ìŒ ë‹¨ê³„ ê¶Œì¥ì‚¬í•­

### 10.1 ì½”ë“œ ì •ë¦¬
- [ ] ë¶ˆí•„ìš”í•œ import ì œê±°
- [ ] ì‚¬ìš©í•˜ì§€ ì•ŠëŠ” ì„¸ì…˜ ìŠ¤í† ë¦¬ì§€ ì €ì¥ ë¡œì§ ì œê±°
- [ ] ì£¼ì„ ì²˜ë¦¬ëœ ì½”ë“œ ì •ë¦¬

### 10.2 ê¸°ëŠ¥ ê°œì„ 
- [ ] playTrack í•¨ìˆ˜ ìˆ˜ì • (í´ë¦­í•œ íŠ¸ë™ë§Œ ì¬ìƒ)
- [ ] ì—ëŸ¬ ì²˜ë¦¬ ê°œì„ 
- [ ] ë¡œë”© ìƒíƒœ ê°œì„ 

### 10.3 ìµœì í™”
- [ ] API ì‚¬ìš©ëŸ‰ ëª¨ë‹ˆí„°ë§ ì¶”ê°€
- [ ] ìºì‹± ì‹œìŠ¤í…œ êµ¬í˜„
- [ ] ì‚¬ìš©ì ì œí•œ ì„¤ì •

---

## ğŸ“¦ 11. ì„¤ì¹˜í•´ì•¼ í•˜ëŠ” íŒ¨í‚¤ì§€ë“¤ (npm install)

### 11.1 ì„œë²„ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (server í´ë”)

#### í•„ìˆ˜ ì˜ì¡´ì„± (dependencies)
```bash
cd server
npm install express@^4.21.2
npm install cors@^2.8.5
npm install helmet@^7.1.0
npm install express-rate-limit@^7.1.5
npm install dotenv@^16.3.1
```

#### ê°œë°œ ì˜ì¡´ì„± (devDependencies)
```bash
npm install -D @types/express@^4.17.21
npm install -D @types/cors@^2.8.17
npm install -D @types/node@^20.10.0
npm install -D typescript@^5.9.3
npm install -D ts-node@^10.9.2
```

#### í•œ ë²ˆì— ì„¤ì¹˜í•˜ê¸°
```bash
cd server
npm install express cors helmet express-rate-limit dotenv
npm install -D @types/express @types/cors @types/node typescript ts-node
```

### 11.2 í´ë¼ì´ì–¸íŠ¸ íŒ¨í‚¤ì§€ ì„¤ì¹˜ (ë£¨íŠ¸ í´ë”)

#### ê¸°ì¡´ íŒ¨í‚¤ì§€ (ì´ë¯¸ ì„¤ì¹˜ë¨)
```bash
# React ê´€ë ¨ (ì´ë¯¸ ì„¤ì¹˜ë¨)
npm install react react-dom

# TypeScript ê´€ë ¨ (ì´ë¯¸ ì„¤ì¹˜ë¨)
npm install typescript @types/react @types/react-dom @types/node

# ê¸°íƒ€ ìœ í‹¸ë¦¬í‹° (ì´ë¯¸ ì„¤ì¹˜ë¨)
npm install styled-components axios firebase
```

#### ìƒˆë¡œ ì¶”ê°€ëœ íŒ¨í‚¤ì§€ (ì—†ìŒ)
```bash
# í´ë¼ì´ì–¸íŠ¸ì—ëŠ” ìƒˆë¡œìš´ íŒ¨í‚¤ì§€ ì„¤ì¹˜ê°€ í•„ìš”í•˜ì§€ ì•ŠìŒ
# ëª¨ë“  ê¸°ëŠ¥ì´ ê¸°ì¡´ íŒ¨í‚¤ì§€ë¡œ êµ¬í˜„ë¨
```

### 11.3 í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

#### ì„œë²„ í™˜ê²½ ë³€ìˆ˜ (server/.env)
```bash
# Gemini AI API í‚¤
GEMINI_API_KEY=your_gemini_api_key_here

# ëª¨ë¸ ì„¤ì •
GEMINI_MODEL=gemini-2.0-flash

# ì„œë²„ í¬íŠ¸
PORT=5000
PORT_ALT=5001

# í™˜ê²½ ì„¤ì •
NODE_ENV=development

# í”„ë¡ íŠ¸ì—”ë“œ URL
FRONTEND_URL=http://localhost:3000
```

#### í´ë¼ì´ì–¸íŠ¸ í™˜ê²½ ë³€ìˆ˜ (ë£¨íŠ¸ .env)
```bash
# ê¸°ì¡´ YouTube API í‚¤ (í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ìš© ë°±ì—…)
REACT_APP_YOUTUBE_API_KEY=AIzaSyBNWPwKZ26XlK0O5JCqooZFoAk2FScx2fE
```

### 11.4 ì„¤ì¹˜ ìˆœì„œ

#### 1ë‹¨ê³„: ì„œë²„ íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
# server í´ë”ë¡œ ì´ë™
cd server

# package.json ìƒì„± (ì´ë¯¸ ìˆìŒ)
# npm init -y

# ì˜ì¡´ì„± ì„¤ì¹˜
npm install express cors helmet express-rate-limit dotenv
npm install -D @types/express @types/cors @types/node typescript ts-node
```

#### 2ë‹¨ê³„: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
```bash
# server/.env íŒŒì¼ ìƒì„± ë° ì„¤ì •
echo "GEMINI_API_KEY=your_gemini_api_key_here" > server/.env
echo "GEMINI_MODEL=gemini-2.0-flash" >> server/.env
echo "PORT=5000" >> server/.env
echo "PORT_ALT=5001" >> server/.env
echo "NODE_ENV=development" >> server/.env
echo "FRONTEND_URL=http://localhost:3000" >> server/.env
```

#### 3ë‹¨ê³„: í´ë¼ì´ì–¸íŠ¸ ì„¤ì •
```bash
# ë£¨íŠ¸ í´ë”ë¡œ ì´ë™
cd ..

# package.jsonì— í”„ë¡ì‹œ ì„¤ì • ì¶”ê°€ (ì´ë¯¸ ì™„ë£Œ)
# "proxy": "http://localhost:5000"
```

### 11.5 ì‹¤í–‰ ëª…ë ¹ì–´

#### ì„œë²„ ì‹¤í–‰
```bash
cd server
npm start
# ë˜ëŠ”
npm run dev
```

#### í´ë¼ì´ì–¸íŠ¸ ì‹¤í–‰
```bash
# ë£¨íŠ¸ í´ë”ì—ì„œ
npm start
```

### 11.6 íŒ¨í‚¤ì§€ ë²„ì „ ì •ë³´

#### ì„œë²„ íŒ¨í‚¤ì§€ ë²„ì „
- **express**: ^4.21.2
- **cors**: ^2.8.5
- **helmet**: ^7.1.0
- **express-rate-limit**: ^7.1.5
- **dotenv**: ^16.3.1
- **@types/express**: ^4.17.21
- **@types/cors**: ^2.8.17
- **@types/node**: ^20.10.0
- **typescript**: ^5.9.3
- **ts-node**: ^10.9.2

#### í´ë¼ì´ì–¸íŠ¸ íŒ¨í‚¤ì§€ ë²„ì „
- **react**: ^18.3.1 (ê¸°ì¡´)
- **typescript**: ^4.9.5 (ê¸°ì¡´)
- **styled-components**: ^6.1.19 (ê¸°ì¡´)
- **firebase**: ^12.2.1 (ê¸°ì¡´)

---

**ğŸ“… ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸**: 2025ë…„ 1ì›”
**ğŸ‘¨â€ğŸ’» ì‘ì„±ì**: AI Assistant
**ğŸ“‹ ë²„ì „**: 6.0 (LOOP í”„ë¡œì íŠ¸ìš© - í”„ë¡œë•ì…˜ ë ˆë²¨ ë°±ì—”ë“œ í”„ë¡ì‹œ)
